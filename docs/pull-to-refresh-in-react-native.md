---
layout: post
date: 2015-12-10 19:50:32 GMT
tags:
- react native
- javascript
- ios
- apps
- ios app development
- flux
- ipad
- iphone
- constellational
title: "Pull to refresh in React Native"
---
# Pull to refresh in React Native

<p>I’m <a href="http://github.com/constellational">building an app</a> to share notes (<a href="http://constellational.com/">Constellational</a> — <a href="http://eepurl.com/bHN6Mf">sign up here</a>!) and one thing I’ve wanted is to be able to <a href="https://github.com/constellational/iOS/issues/52">use it on my iPad as well as my phone</a>. To do this, I <a href="http://arpith.co/post/134737535752/keeping-track-of-what-youve-read">need some way</a> to refresh the list of <a href="http://arpith.co/post/134069674682/drafts-unpublished-edits-and-posts">posts</a> on one device when I’ve made some changes on the other device.<br></p><figure class="tmblr-full" data-orig-height="1536" data-orig-width="2048"><img src="/images/4a09769d6adaa8699ec3ee800059dcb807ec574fd1ef45298ce07e191471349d.png" data-orig-height="1536" data-orig-width="2048"></figure><p>React Native’s <a href="https://facebook.github.io/react-native/docs/listview.html">ListView</a> is built on <a href="https://facebook.github.io/react-native/docs/scrollview.html">ScrollView</a>, which has an <a href="https://facebook.github.io/react-native/docs/scrollview.html#onrefreshstart">onRefreshStart prop</a>. You pass it a function that accepts a callback as a param and calls the callback once you’re done refreshing (the callback tells the spinner it’s time to scoot).</p><p>This means the render function of the <a href="https://github.com/constellational/iOS/blob/master/components/PostsPage.js">Posts Page component</a> now looks like:</p><pre>render() {<br> &nbsp;var title = 'All Posts';<br> &nbsp;if (this.props.filter) title = this.props.filter;<br> &nbsp;return (<br> &nbsp; &nbsp;&lt;View style={styles.page}&gt;<br> &nbsp; &nbsp; &nbsp;&lt;NavBar<br> &nbsp; &nbsp; &nbsp; &nbsp;leftButton={this.backButton}<br> &nbsp; &nbsp; &nbsp; &nbsp;title={title}<br> &nbsp; &nbsp; &nbsp; &nbsp;rightButton={this.createButton}<br> &nbsp; &nbsp; &nbsp;/&gt;<br> &nbsp; &nbsp; &nbsp;&lt;ListView<br> &nbsp; &nbsp; &nbsp; &nbsp;automaticallyAdjustContentInsets={false}<br> &nbsp; &nbsp; &nbsp; &nbsp;dataSource={this.state.posts}<br> &nbsp; &nbsp; &nbsp; &nbsp;renderRow={post =&gt; (&lt;Post post={post}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nav={this.props.navigator}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;key={post.id}<br> &nbsp; &nbsp; &nbsp; &nbsp;/&gt;)}<br> &nbsp; &nbsp; &nbsp; &nbsp;onRefreshStart={(endRefreshing) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PostActions.fetchUser(this.props.username);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;endRefreshing();<br> &nbsp; &nbsp; &nbsp; &nbsp;}}<br> &nbsp; &nbsp; &nbsp; &nbsp;style={styles.list}<br> &nbsp; &nbsp; &nbsp;/&gt;<br> &nbsp; &nbsp;&lt;/View&gt;<br> &nbsp;);<br>}</pre><p>I also <a href="https://github.com/constellational/iOS/blob/38a5728ff38c8d776434545ec83d0443da7b5f82/actions/PostActions.js">added</a> a <a href="https://facebook.github.io/flux/">flux</a> <a href="https://facebook.github.io/flux/docs/overview.html#actions">action</a> to fetch the user’s data off the server:</p><pre>fetchUser: function(username) {<br> &nbsp;AppDispatcher.dispatch({<br> &nbsp; &nbsp;actionType: 'fetch-user',<br> &nbsp; &nbsp;username: username<br> &nbsp;});<br>}</pre><p>And in my <a href="https://github.com/constellational/iOS/blob/38a5728ff38c8d776434545ec83d0443da7b5f82/stores/PostStore.js">Post Store</a>:</p><pre>function fetchUser(username) {<br> &nbsp;var url = USER_URL + '/' + username;<br> &nbsp;return fetch(url).then(res =&gt; res.json()).then((user) =&gt; {<br> &nbsp; &nbsp;_users[username] = user;<br> &nbsp; &nbsp;PostStore.emitChange();<br> &nbsp;});<br>}</pre><pre>AppDispatcher.register(function(action) {<br> &nbsp;case 'fetch-user':<br> &nbsp; &nbsp;var username = action.username;<br> &nbsp; &nbsp;if (!username) username = SettingStore.getUsername();<br> &nbsp; &nbsp;fetchUser(username);<br> &nbsp; &nbsp;break;<br>}</pre><p>Note that this works when <a href="http://arpith.co/post/134539082857/sharing-a-post">you’re viewing</a> <a href="http://arpith.co/post/133734557012/you-say-username-i-say-username">other user</a>’s <a href="http://arpith.co/post/134595293672/reading-everyone-you-love">posts</a> as well. This fixes <a href="https://github.com/constellational/iOS/issues/52">#52</a>.</p>