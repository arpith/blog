---
layout: post
date: 2015-11-30 13:49:43 GMT
tags:
- reactjs
- server side react
- isomorphic app
- ejs
- template
- html
- web development
- koa
- heroku
- javascript
title: "Server Side React + EJS"
---
<p><a href="http://arpith.co/post/134206819927/displaying-your-webpage">Yesterday</a>, I mentioned that my <a href="github.com/constellational">app’s</a> <a href="github.com/constellational/web">webpages</a> (at <a href="http://constellational.com/">constellational.com</a>) were being generated by joining strings. This is a way around that, using <a href="http://www.embeddedjs.com/">EJS</a> to place the <a href="http://arpith.co/post/133415247167/isomorphic-react-in-three-simple-steps">server side react data</a> into an html template. <a href="https://github.com/constellational/web/blob/f4fc5e08f01804b694aa55556b471bdaeee71334/templates/layout.html">The template itself is simple</a>:</p><pre>&lt;html&gt;<br>  &lt;head&gt;<br>    &lt;meta http-equiv='Content-Type' content='text/html; charset=utf-8'&gt;<br>    &lt;meta name='viewport' content='width=device-width, initial-scale=1' /&gt;<br>    &lt;link rel='stylesheet' type='text/css' href='/style.css'<br>    &lt;title&gt;Constellational&lt;/title&gt;<br>  &lt;/head&gt;<br>  &lt;body&gt;<br>    &lt;div id='react-mount'&gt;&lt;%- react -%&gt;&lt;/div&gt;<br>    &lt;script src='/main.js' type='text/javascript'&gt;&lt;/script&gt;<br>  &lt;/body&gt;<br>&lt;/html&gt;</pre><p>All I’ve done is add &lt;%- react -%&gt; where I want my react string to be inserted. I’ve placed this file in a folder called templates, and made a small change to <a href="https://github.com/constellational/web/blob/f4fc5e08f01804b694aa55556b471bdaeee71334/index.js">the code that serves the user pages</a>:</p><pre>var render = require('koa-ejs');</pre><pre>render(app, {root: 'templates'});</pre><pre>app.use(function *() {<br>  var splitURL = this.url.split('/');<br>  splitURL.shift();<br>  var username = splitURL.shift().toLowerCase();<br>  var id = splitURL.shift();<br>  var user = yield fetchUser(username).then((user) =&gt; {<br>    if ((id) &amp;&amp; (user.posts.indexOf(id) &gt; 0)) {<br>      user.posts.splice(user.posts.indexOf(id), 1);<br>      user.posts.unshift(id);<br>    }<br>    var promiseArr = user.posts.map(id =&gt; fetchPost(username, id));<br>    return Promise.all(promiseArr).then((data) =&gt; {<br>      user.posts = data;<br>      return user;<br>    });<br>  });<br>  var reactString = ReactDOMServer.renderToString(React.createElement(views.User, user));<br>  yield this.render('layout', {react: reactString});<br>});</pre><p>Add <a href="https://github.com/koajs/ejs">koa-ejs</a> to your <a href="http://arpith.co/post/133345400442/a-double-page-app">list of dependencies</a> (in your <a href="https://docs.npmjs.com/files/package.json">package.json</a>) and <a href="https://devcenter.heroku.com/articles/github-integration#automatic-deploys">Heroku will take care of the rest</a>! This fixes <a href="https://github.com/constellational/web/issues/11">#11</a>.</p>